(function(){const btn=document.getElementById('themeToggle');if(!btn)return;const key='prefers-theme';function apply(t){t==='light'?document.documentElement.classList.add('light'):document.documentElement.classList.remove('light')}const saved=localStorage.getItem(key);if(saved)apply(saved);btn.addEventListener('click',()=>{const now=document.documentElement.classList.contains('light')?'dark':'light';localStorage.setItem(key,now);apply(now);})})();(function(){const input=document.getElementById('quickSearch');if(!input)return;const cards=Array.from(document.querySelectorAll('.cards .card'));function n(s){return(s||'').toLowerCase()}input.addEventListener('input',()=>{const q=n(input.value);cards.forEach(c=>{const txt=n(c.textContent);c.style.display=(q===''||txt.includes(q))?'':'none';c.querySelectorAll('details.drop').forEach(d=>{d.open=q!=='' && n(d.textContent).includes(q);});});});})();async function loadUpdates(){try{const res=await fetch('data/amendments.json?_='+Date.now());const data=await res.json();const list=document.getElementById('updates-list');list.innerHTML='';(data.items||[]).slice(0,60).forEach(item=>{const div=document.createElement('div');div.className='update';div.innerHTML=`<h4><a target="_blank" href="${item.link}">${item.title}</a></h4><div class="meta">${item.source||''} ${item.date?'â€¢ '+item.date:''}</div>${item.summary?`<p>${item.summary}</p>`:''}`;list.appendChild(div);});}catch(e){console.error(e);document.getElementById('updates-list').innerHTML='<p class="note">Could not load updates. Ensure <code>data/amendments.json</code> exists.</p>'}}const r=document.getElementById('refresh');if(r)r.addEventListener('click',loadUpdates);window.addEventListener('DOMContentLoaded',loadUpdates);